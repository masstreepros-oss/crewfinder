<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>CrewFinder ‚Äî Industry News</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Outfit', -apple-system, sans-serif; background: #E8E8E8; display: flex; justify-content: center; min-height: 100vh; }
  #app { width: 100%; max-width: 430px; min-height: 100vh; background: #F7FAF7; display: flex; flex-direction: column; }
  @media (min-width: 431px) { body { padding: 20px; align-items: center; } #app { min-height: 85vh; max-height: 90vh; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); overflow: hidden; } }
  .header { background: #fff; padding: 12px 16px; border-bottom: 1px solid #E8E8E8; display: flex; justify-content: space-between; align-items: center; }
  .header-logo { display: flex; align-items: center; gap: 8px; }
  .header-logo svg { width: 28px; height: 28px; }
  .header-logo span { font-weight: 800; font-size: 18px; color: #1A3C2A; }
  .header-back { background: none; border: 1px solid #DDD; border-radius: 8px; padding: 5px 12px; font-size: 11px; color: #888; cursor: pointer; font-family: inherit; }
  .content { flex: 1; overflow-y: auto; padding: 16px; }

  /* Featured */
  .featured-card {
    background: linear-gradient(135deg, #050D09, #1A3C2A, #2D7A3A);
    border-radius: 14px; padding: 16px; margin-bottom: 10px; color: #fff; cursor: pointer;
  }
  .featured-badges { display: flex; gap: 6px; margin-bottom: 6px; }
  .featured-badge { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
  .featured-title { font-weight: 800; font-size: 16px; margin-bottom: 6px; line-height: 1.3; }
  .featured-summary { font-size: 13px; opacity: 0.8; line-height: 1.5; }
  .featured-source { font-size: 11px; opacity: 0.5; margin-top: 8px; }

  .filters { display: flex; gap: 6px; margin-bottom: 14px; overflow-x: auto; padding-bottom: 4px; }
  .filters::-webkit-scrollbar { display: none; }
  .filter-pill { padding: 7px 14px; border-radius: 20px; border: none; background: #E8EDE9; color: #5A6B5E; font-size: 12px; font-weight: 600; cursor: pointer; font-family: inherit; white-space: nowrap; }
  .filter-pill.active { background: #2D7A3A; color: #fff; }

  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
  .section-title { font-size: 16px; font-weight: 700; color: #1A3C2A; }
  .count-badge { display: inline-flex; padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; color: #2D7A3A; background: rgba(45,122,58,0.1); margin-left: 8px; }

  .news-card { background: #fff; border-radius: 14px; border: 1px solid #E2E8E4; padding: 14px 16px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.04); cursor: pointer; }
  .news-row { display: flex; gap: 10px; }
  .news-icon { width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
  .news-info { flex: 1; min-width: 0; }
  .news-badges { display: flex; gap: 6px; margin-bottom: 4px; align-items: center; }
  .badge { display: inline-flex; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
  .news-time { font-size: 11px; color: #8A9B8E; }
  .news-title { font-weight: 700; font-size: 14px; color: #1A3C2A; margin-bottom: 4px; line-height: 1.3; }
  .news-summary { font-size: 12px; color: #5A6B5E; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
  .news-source { font-size: 11px; color: #8A9B8E; margin-top: 4px; }

  /* Detail */
  .detail-back { background: none; border: none; color: #2D7A3A; font-weight: 600; font-size: 14px; cursor: pointer; font-family: inherit; padding: 0; margin-bottom: 12px; }
  .detail-cat { display: flex; gap: 6px; margin-bottom: 8px; }
  .detail-title { font-size: 22px; font-weight: 800; color: #1A3C2A; line-height: 1.3; margin-bottom: 8px; }
  .detail-meta { display: flex; gap: 12px; margin-bottom: 16px; font-size: 13px; color: #8A9B8E; }
  .detail-body { font-size: 15px; line-height: 1.7; color: #3A4B3E; }
  .detail-link { display: block; margin-top: 16px; color: #2D7A3A; font-weight: 600; font-size: 14px; }

  .empty { text-align: center; padding: 32px 16px; color: #8A9B8E; }
  .loading { text-align: center; padding: 32px; color: #8A9B8E; }
  .spinner { display: inline-block; width: 24px; height: 24px; border: 3px solid #E2E8E4; border-top-color: #2D7A3A; border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .bottom-nav { background: #fff; border-top: 1px solid #E8E8E8; display: flex; padding: 6px 8px 10px; }
  .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 2px; background: none; border: none; cursor: pointer; color: #8A9B8E; font-family: inherit; padding: 6px 0; text-decoration: none; }
  .nav-item.active { color: #2D7A3A; }
  .nav-item span { font-size: 10px; font-weight: 500; }
  .nav-item.active span { font-weight: 700; }
  .nav-dot { width: 4px; height: 4px; border-radius: 50%; background: #2D7A3A; }
</style>
</head>
<body>
<div id="app">
  <div class="header">
    <div class="header-logo">
      <svg viewBox="0 0 100 100" fill="none"><path d="M50 8 L30 40 L38 40 L22 65 L32 65 L18 90 L82 90 L68 65 L78 65 L62 40 L70 40 Z" fill="#2D7A3A" opacity="0.9"/><rect x="44" y="85" width="12" height="15" rx="2" fill="#5D4037"/></svg>
      <span>CrewFinder</span>
    </div>
    <button class="header-back" onclick="window.location.href='app.html'">‚Üê App</button>
  </div>
  <div class="content" id="content"><div class="loading"><div class="spinner"></div><div style="margin-top:8px">Loading news...</div></div></div>
  <div class="bottom-nav">
    <a href="app.html" class="nav-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg><span>Jobs</span></a>
    <a href="calendar.html" class="nav-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span>Calendar</span></a>
    <a href="equipment.html" class="nav-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg><span>Gear</span></a>
    <a href="storm.html" class="nav-item"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 16.9A5 5 0 0 0 18 7h-1.26a8 8 0 1 0-11.62 9"/><polyline points="13 11 9 17 15 17 11 23"/></svg><span>Storm</span></a>
    <a href="news.html" class="nav-item active"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2Zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><path d="M18 14h-8"/><path d="M15 18h-5"/><path d="M10 6h8v4h-8V6Z"/></svg><span>News</span><div class="nav-dot"></div></a>
  </div>
</div>
<script>
const SUPABASE_URL = 'https://mhatwlmbwikvrlcgfojt.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1oYXR3bG1id2lrdnJsY2dmb2p0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgxMDQ4ODYsImV4cCI6MjA1MzY4MDg4Nn0.CHiaEB4vg1qCCpnOb4cOYGP6O_-TE_0Iu21VDnORfCE';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const content = document.getElementById('content');
let category = 'all';
let articles = [];

const CAT_ICONS = { safety: 'ü¶∫', equipment: 'üîß', business: 'üíº', weather: 'üå§Ô∏è', regulations: 'üìã', training: 'üéì', events: 'üìÖ', general: 'üì∞' };
const CAT_COLORS = { safety: '#C62828', equipment: '#4527A0', business: '#1565C0', weather: '#00838F', regulations: '#E65100', training: '#2E7D32', events: '#6A1B9A', general: '#37474F' };

const CATEGORIES = [
  { id: 'all', label: 'All' }, { id: 'weather', label: 'üå§Ô∏è Weather' },
  { id: 'safety', label: 'ü¶∫ Safety' }, { id: 'equipment', label: 'üîß Equipment' },
  { id: 'business', label: 'üíº Business' }, { id: 'regulations', label: 'üìã Regulations' },
  { id: 'training', label: 'üéì Training' }, { id: 'events', label: 'üìÖ Events' },
];

function timeAgo(d) { const m = Math.floor((Date.now() - new Date(d).getTime()) / 60000); if (m < 60) return m + 'm ago'; const h = Math.floor(m/60); if (h < 24) return h + 'h ago'; const dy = Math.floor(h/24); if (dy < 7) return dy + 'd ago'; return Math.floor(dy/7) + 'w ago'; }

async function loadNews() {
  let q = sb.from('industry_news').select('*').order('published_at', { ascending: false });
  if (category !== 'all') q = q.eq('category', category);
  const { data, error } = await q;
  articles = data || [];
  renderNews();
}

function renderNews() {
  const featured = category === 'all' ? articles.filter(a => a.is_featured) : [];
  const rest = category === 'all' ? articles.filter(a => !a.is_featured) : articles;

  content.innerHTML = `
    ${featured.length > 0 ? featured.map(a => `
      <div class="featured-card" onclick="showDetail('${a.id}')">
        <div class="featured-badges">
          <span class="featured-badge">${CAT_ICONS[a.category] || 'üì∞'} ${a.category || 'general'}</span>
          <span class="featured-badge">${timeAgo(a.published_at)}</span>
        </div>
        <div class="featured-title">${a.title}</div>
        <div class="featured-summary">${a.summary || ''}</div>
        <div class="featured-source">Source: ${a.source_name || 'CrewFinder'}</div>
      </div>
    `).join('') : ''}
    <div class="filters">
      ${CATEGORIES.map(c => `<button class="filter-pill ${category === c.id ? 'active' : ''}" onclick="setCat('${c.id}')">${c.label}</button>`).join('')}
    </div>
    <div class="section-header">
      <div><span class="section-title">Latest</span><span class="count-badge">${rest.length}</span></div>
    </div>
    ${rest.length === 0 ? `<div class="empty"><div style="font-size:32px;margin-bottom:8px">üì∞</div><div style="font-weight:600;color:#5A6B5E">No news articles yet</div><div style="font-size:13px;margin-top:4px">Check back soon for industry updates</div></div>` :
    rest.map(a => `
      <div class="news-card" onclick="showDetail('${a.id}')">
        <div class="news-row">
          <div class="news-icon" style="background:${(CAT_COLORS[a.category] || '#37474F')}12">${CAT_ICONS[a.category] || 'üì∞'}</div>
          <div class="news-info">
            <div class="news-badges">
              <span class="badge" style="color:${CAT_COLORS[a.category] || '#37474F'};background:${(CAT_COLORS[a.category] || '#37474F')}15">${a.category || 'general'}</span>
              <span class="news-time">${timeAgo(a.published_at)}</span>
            </div>
            <div class="news-title">${a.title}</div>
            <div class="news-summary">${a.summary || ''}</div>
            <div class="news-source">${a.source_name || 'CrewFinder'}</div>
          </div>
        </div>
      </div>
    `).join('')}
  `;
}

function showDetail(id) {
  const a = articles.find(x => x.id === id);
  if (!a) return;
  content.innerHTML = `
    <button class="detail-back" onclick="loadNews()">‚Üê Back to news</button>
    <div class="detail-cat">
      <span class="badge" style="color:${CAT_COLORS[a.category] || '#37474F'};background:${(CAT_COLORS[a.category] || '#37474F')}15">${CAT_ICONS[a.category] || 'üì∞'} ${a.category || 'general'}</span>
    </div>
    <div class="detail-title">${a.title}</div>
    <div class="detail-meta">
      <span>${a.source_name || 'CrewFinder'}</span>
      <span>${timeAgo(a.published_at)}</span>
    </div>
    <div class="detail-body">${a.content || a.summary || 'No content available.'}</div>
    ${a.source_url ? `<a href="${a.source_url}" target="_blank" class="detail-link">Read full article ‚Üí</a>` : ''}
  `;
  content.scrollTop = 0;
}

function setCat(c) { category = c; loadNews(); }

loadNews();
</script>
</body>
</html>
